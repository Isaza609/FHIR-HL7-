# 6. Plan de Tareas por Requisito

Con el fin de garantizar el cumplimiento de los requisitos funcionales y no funcionales definidos para el sistema de interoperabilidad de agendas de **ACME Salud**, se establecen las siguientes tareas específicas.  
El cumplimiento de cada par de tareas permitirá dar por satisfecho el requisito correspondiente.

---

## 6.1 Requisitos Funcionales

### RF-01 – Gestión de Sedes

**Objetivo:**  
Modelar las tres sedes de ACME Salud dentro del servidor FHIR.

**Tarea 1:**  
Crear los tres recursos `Location` correspondientes a las sedes **Norte**, **Centro** y **Sur**, incluyendo como mínimo:
- `id`
- `identifier`
- `name`
- `managingOrganization` (referencia a `Organization` – ACME Salud)

**Tarea 2:**  
Verificar que cada `Location` esté correctamente asociada a la `Organization` principal y documentar la relación **Organization → Location** en una tabla de validación.

---

### RF-02 – Gestión de Servicios

**Objetivo:**  
Modelar los servicios médicos ofrecidos en cada sede.

**Tarea 1:**  
Crear los recursos `HealthcareService` para cada servicio listado en el escenario, incluyendo:
- `id`
- `name`
- `providedBy` (`Organization`)
- `location` (`Location` correspondiente)

**Tarea 2:**  
Validar que cada servicio esté asociado únicamente a la sede donde se presta, documentando la relación **Location → HealthcareService**.

---

### RF-03 – Gestión de Profesionales

**Objetivo:**  
Modelar los médicos especialistas y su relación con la institución.

**Tarea 1:**  
Crear los recursos `Practitioner` para los seis médicos del escenario, incluyendo:
- `id`
- `identifier` (tarjeta profesional)
- `name`

**Tarea 2:**  
Crear los recursos `PractitionerRole`, vinculando:
- `practitioner`
- `organization` (ACME Salud)
- `location`
- `healthcareService`

Y documentar la relación entre médico, sede y servicio.

---

### RF-04 – Gestión de Aseguradoras y Cobertura

**Objetivo:**  
Representar las aseguradoras y la cobertura del paciente.

**Tarea 1:**  
Crear los recursos `Organization` correspondientes a:
- Salud Completa
- Salud Cooperativa

**Tarea 2:**  
Crear al menos dos ejemplos de `Coverage`, vinculando:
- `beneficiary` (`Patient`)
- `payor` (`Organization` – aseguradora)
- `status`

Y verificar que el `Coverage` permita identificar la aseguradora del paciente.

---

### RF-05 – Gestión de Agendas

**Objetivo:**  
Modelar agendas mensuales por servicio y por médico.

**Tarea 1:**  
Crear recursos `Schedule` mensuales asociados a:
- `HealthcareService` (agenda por servicio)

Incluyendo:
- `id`
- `actor`
- `planningHorizon` (inicio y fin del mes)

**Tarea 2:**  
Crear recursos `Schedule` mensuales asociados a:
- `PractitionerRole` (agenda por médico)

Y documentar la diferencia entre ambos tipos de agenda.

---

### RF-06 – Consulta de Disponibilidad

**Objetivo:**  
Permitir la visualización de espacios disponibles.

**Tarea 1:**  
Crear múltiples recursos `Slot` asociados a un `Schedule`, definiendo:
- `id`
- `start`
- `end`
- `status = free`

**Tarea 2:**  
Simular una consulta de disponibilidad mostrando únicamente los `Slot` con estado **free**, filtrados por:
- sede
- servicio
- profesional

---

### RF-07 – Agendamiento de Cita

**Objetivo:**  
Registrar una cita médica y reservar el espacio correspondiente.

**Tarea 1:**  
Crear un recurso `Appointment` que incluya:
- `id`
- `status = booked`
- `start`
- `end`
- `participant` (`Patient` y `PractitionerRole`)
- `serviceType`
- `slot` (referencia al `Slot` seleccionado)

**Tarea 2:**  
Actualizar el `Slot.status` a **busy** y generar un recurso `AppointmentResponse` con:
- `appointment`
- `actor` (`Patient`)
- `participantStatus = accepted`

---

### RF-08 – Cancelación de Cita

**Objetivo:**  
Permitir la cancelación de una cita existente.

**Tarea 1:**  
Actualizar un `Appointment` existente cambiando:
- `status = cancelled`
- `cancellationReason`

**Tarea 2:**  
Actualizar el `Slot` asociado cambiando:
- `status = free`

Y documentar el cambio de estados antes y después.

---

### RF-09 – Determinación de Duración de Cita

**Objetivo:**  
Aplicar la tabla de tiempos según aseguradora y tipo de consulta.

**Tarea 1:**  
Construir una matriz de reglas que relacione:
- Tipo de consulta
- Aseguradora
- Duración en minutos

**Tarea 2:**  
Demostrar mediante dos casos prácticos que la duración del `Slot` (`end – start`) corresponde a la regla definida según el `Coverage` del paciente.

---

## 6.2 Requisitos No Funcionales

### RNF-01 – Interoperabilidad (HL7 FHIR R4)

**Tarea 1:**  
Declarar formalmente que la solución se basa en el estándar **HL7 FHIR R4**.

**Tarea 2:**  
Verificar que todos los recursos modelados utilicen nombres de campos oficiales definidos en FHIR.

---

### RNF-02 – Centralización del Sistema

**Tarea 1:**  
Describir el flujo donde todos los canales (web, app, call center, HIS) envían solicitudes al servidor FHIR central.

**Tarea 2:**  
Elaborar un esquema textual que represente:  
**Canal → FHIR Server → Schedule/Slot → Appointment**

---

### RNF-03 – Consistencia de Datos

**Tarea 1:**  
Definir la regla: un `Slot` con `status = busy` no puede asociarse a un nuevo `Appointment` activo.

**Tarea 2:**  
Simular un intento de doble reserva y documentar el comportamiento esperado (rechazo o validación).

---

### RNF-04 – Integridad de Estados

**Tarea 1:**  
Definir los estados válidos mínimos:
- `Slot`: free / busy
- `Appointment`: booked / cancelled

**Tarea 2:**  
Documentar un caso de agendamiento y uno de cancelación verificando coherencia en los cambios de estado.

---

### RNF-05 – Trazabilidad

**Tarea 1:**  
Definir una convención de identificadores únicos para cada recurso.

**Tarea 2:**  
Validar que todos los recursos creados tengan un `id` único y correctamente referenciado.

---

### RNF-06 – Soporte Multicanal

**Tarea 1:**  
Listar los cuatro canales de atención y describir qué recurso envían y reciben.

**Tarea 2:**  
Demostrar que el modelo FHIR no cambia independientemente del canal utilizado.