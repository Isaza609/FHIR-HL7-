# Modelo Conceptual de Interoperabilidad basado en HL7 FHIR

## 1. Identificación de Recursos FHIR

Para el diseño del modelo de interoperabilidad de ACME Salud, se identifican los siguientes recursos FHIR necesarios para representar los elementos del escenario:

| Elemento del escenario | Recurso FHIR | Justificación |
|---|---|---|
| Institución ACME Salud | Organization | Representa la entidad prestadora de servicios de salud. |
| Puntos de atención (Norte, Centro, Sur) | Location | Representan las sedes físicas donde se prestan los servicios. |
| Servicios médicos (Pediatría, Nefrología, etc.) | HealthcareService | Representa cada servicio especializado ofrecido en una sede. |
| Médico especialista | Practitioner | Representa al profesional de salud. |
| Rol del médico en la institución | PractitionerRole | Define la relación entre el médico, la organización y el servicio que presta. |
| Paciente | Patient | Representa al usuario que solicita la cita. |
| Aseguradora | Organization | Representa la entidad aseguradora con convenio. |
| Cobertura del paciente | Coverage | Relaciona al paciente con la aseguradora. |
| Agenda mensual | Schedule | Define la disponibilidad de un servicio o de un médico. |
| Espacios disponibles de agenda | Slot | Representa cada intervalo de tiempo disponible dentro de un Schedule. |
| Cita médica | Appointment | Representa la reserva formal de un Slot para un paciente. |
| Confirmación de cita | AppointmentResponse | Representa la respuesta al paciente confirmando la cita. |

---

## 2. Relaciones entre los Recursos

El modelo conceptual establece las siguientes relaciones principales:

1. **Organization (ACME Salud)** se relaciona con múltiples **Location (sedes)**.

2. Cada **Location** ofrece varios **HealthcareService**.

3. Cada **Practitioner** se vincula a la institución mediante **PractitionerRole**, el cual especifica:
   - Organización
   - Servicio prestado
   - Sede

4. Cada **HealthcareService** y cada **PractitionerRole** pueden tener su propio **Schedule** mensual.

5. Cada **Schedule** contiene múltiples **Slot**, que representan los intervalos de tiempo disponibles.

6. El **Patient** se relaciona con una aseguradora mediante el recurso **Coverage**, donde:
   - `Coverage.beneficiary → Patient`
   - `Coverage.payor → Organization (aseguradora)`

7. El recurso **Appointment** relaciona:
   - Patient
   - PractitionerRole
   - HealthcareService
   - Slot

8. Una vez creada la cita, se genera un **AppointmentResponse**, asociado al **Appointment**.

---

## 3. Modelo Lógico del Flujo de Agendamiento

El flujo conceptual del proceso de agendamiento es el siguiente:

1. El paciente consulta disponibilidad de citas en una sede y servicio específico.
2. El sistema consulta los **Schedule** correspondientes y los **Slot** disponibles.
3. Con base en el tipo de consulta y la aseguradora (**Coverage**), se determina la duración adecuada.
4. Se crea un recurso **Appointment**, reservando el **Slot** seleccionado.
5. El estado del **Slot** cambia de `free` a `busy`.
6. Se genera un recurso **AppointmentResponse** como confirmación al paciente.

### En caso de cancelación
- El `Appointment.status` cambia a `cancelled`
- Se registra el motivo en `Appointment.cancellationReason`
- El `Slot` vuelve a estado `free`

---

## 4. Consideraciones del Modelo

- Se implementan dos tipos de agenda:
  - Agenda por servicio (**HealthcareService → Schedule**)
  - Agenda por médico (**PractitionerRole → Schedule**)

- La duración de los **Slot** se determina según:
  - Tipo de consulta
  - Aseguradora del paciente

- El servidor central FHIR actúa como repositorio maestro para garantizar la integridad y sincronización de las agendas entre los distintos canales de atención.